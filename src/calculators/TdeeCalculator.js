import React, { useState } from 'react';
import './TdeeCalculator.css';

function DeficitTimeCalculator() {
  const [unit, setUnit] = useState('imperial');
  const [gender, setGender] = useState('male');
  const [weight, setWeight] = useState(170);
  const [bodyFat, setBodyFat] = useState(18);
  const [workoutHours, setWorkoutHours] = useState(6);
  const [steps, setSteps] = useState(6000);
  const [ageRange, setAgeRange] = useState('under60');
  const [results, setResults] = useState(null);

  const calculate = () => {
    const leanMass = weight * (1 - bodyFat / 100);
    const leanMassKg = unit === 'imperial' ? leanMass / 2.20462 : leanMass;
    const bmr = 370 + (21.6 * leanMassKg);

    let activityMultiplier = 1.3;
    if (workoutHours >= 0 && workoutHours < 3) activityMultiplier = 1.3;
    else if (workoutHours >= 3 && workoutHours < 5) activityMultiplier = 1.4;
    else if (workoutHours >= 5 && workoutHours < 7) activityMultiplier = 1.5;
    else if (workoutHours >= 7) activityMultiplier = 1.55;

    if (steps >= 5000 && steps < 7000) activityMultiplier += 0.05;
    else if (steps >= 7000 && steps < 9000) activityMultiplier += 0.10;
    else if (steps >= 9000 && steps < 11000) activityMultiplier += 0.15;
    else if (steps >= 11000 && steps < 13000) activityMultiplier += 0.20;
    else if (steps >= 13000) activityMultiplier += 0.25;

    activityMultiplier = Math.min(activityMultiplier, 1.8);

    const tdee = bmr * activityMultiplier;
    const slow = tdee - (tdee * 0.15);
    const moderate = tdee - (tdee * 0.24);
    const fast = tdee - (tdee * 0.32);

    const leanBulk = tdee + (tdee * 0.10);
    const standardBulk = tdee + (tdee * 0.20);
    const dirtyBulk = tdee + (tdee * 0.35);

    const standardRecomp = tdee;
    const fatLossRecomp = tdee - (tdee * 0.08);
    const muscleGainRecomp = tdee + (tdee * 0.08);

    setResults({
      lbm: Math.round(leanMass),
      bmr: Math.round(bmr),
      tdee: Math.round(tdee),
      slow: Math.round(slow),
      moderate: Math.round(moderate),
      fast: Math.round(fast),
      leanBulk: Math.round(leanBulk),
      standardBulk: Math.round(standardBulk),
      dirtyBulk: Math.round(dirtyBulk),
      standardRecomp: Math.round(standardRecomp),
      fatLossRecomp: Math.round(fatLossRecomp),
      muscleGainRecomp: Math.round(muscleGainRecomp),
    });
  };

  return (
    <div className="deficit-calculator">
      <h1>Deficit Time Calculator</h1>

      {/* INPUT SECTION */}
      <div className="inputs">
        <div>
          <label>Units:</label>
          <button onClick={() => setUnit('imperial')} className={unit === 'imperial' ? 'active' : ''}>Imperial</button>
          <button onClick={() => setUnit('metric')} className={unit === 'metric' ? 'active' : ''}>Metric</button>
        </div>

        <div>
          <label>Gender:</label>
          <button onClick={() => setGender('male')} className={gender === 'male' ? 'active' : ''}>Male</button>
          <button onClick={() => setGender('female')} className={gender === 'female' ? 'active' : ''}>Female</button>
        </div>

        <div>
          <label>Weight ({unit === 'imperial' ? 'lbs' : 'kg'}):</label>
          <input type="number" value={weight} onChange={e => setWeight(+e.target.value)} />
        </div>

        <div>
          <label>Body Fat %:</label>
          <input type="range" min="5" max="60" value={bodyFat} onChange={e => setBodyFat(+e.target.value)} />
          <span>{bodyFat}%</span>
        </div>

        <div>
          <label>Workout Hours/Week:</label>
          <input type="number" value={workoutHours} onChange={e => setWorkoutHours(+e.target.value)} />
        </div>

        <div>
          <label>Steps/Day:</label>
          <input type="number" value={steps} onChange={e => setSteps(+e.target.value)} />
        </div>

        <div>
          <label>Age Range:</label>
          <button onClick={() => setAgeRange('under60')} className={ageRange === 'under60' ? 'active' : ''}>Under 60</button>
          <button onClick={() => setAgeRange('60plus')} className={ageRange === '60plus' ? 'active' : ''}>61+</button>
        </div>

        <button onClick={calculate} className="calculate-button">Calculate</button>
      </div>

      {/* RESULTS SECTION */}
      {results && (
        <div className="results">
          <h2 className="stats-title">Stats</h2>

          <div className="stats-grid">
            <div className="stat-card">
              <h3>
                LBM 
                <span className="info-icon" data-tooltip="Lean Body Mass ‚Äî your body weight minus fat mass. Includes muscle, bone, water, and organs.">?</span>
              </h3>
              <p>{results.lbm} {unit === 'imperial' ? 'lbs' : 'kg'}</p>
            </div>

            <div className="stat-card">
              <h3>
                BMR 
                <span className="info-icon" data-tooltip="Basal Metabolic Rate ‚Äî calories burned at rest to keep your body alive and functioning.">?</span>
              </h3>
              <p>{results.bmr} cal</p>
            </div>

            <div className="stat-card highlight">
              <h3>
                Estimated TDEE 
                <span className="info-icon" data-tooltip="Total Daily Energy Expenditure ‚Äî your daily calorie burn including workouts and daily activity.">?</span>
              </h3>
              <p>{results.tdee} cal</p>
            </div>
          </div>

          <div className="section-header">
            <h3>‚ùå Calories for Deficit</h3>
          </div>

          <table className="tdee-table">
            <thead>
              <tr>
                <th>Pace</th>
                <th>% per week</th>
                <th>Calorie Intake</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>Slow</td><td>0.5%</td><td>{results.slow} cal</td></tr>
              <tr><td>Moderate</td><td>0.75%</td><td>{results.moderate} cal</td></tr>
              <tr><td>Fast</td><td>1%</td><td>{results.fast} cal</td></tr>
            </tbody>
          </table>

          <div className="section-header">
            <h3>üí™ Calories to Gain</h3>
          </div>

          <table className="tdee-table">
            <thead>
              <tr>
                <th>Type</th>
                <th>Fat Gain</th>
                <th>Calorie Intake</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>Lean Bulk</td><td>Minimal</td><td>{results.leanBulk} cal</td></tr>
              <tr><td>Standard Bulk</td><td>Slight</td><td>{results.standardBulk} cal</td></tr>
              <tr><td>Dirty Bulk</td><td>Moderate</td><td>{results.dirtyBulk} cal</td></tr>
            </tbody>
          </table>

          <div className="section-header">
            <h3>‚öñÔ∏è Recomposition</h3>
          </div>

          <table className="tdee-table">
            <thead>
              <tr>
                <th>Focus</th>
                <th>Calorie Intake</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>Standard</td><td>{results.standardRecomp} cal</td></tr>
              <tr><td>Fat Loss</td><td>{results.fatLossRecomp} cal</td></tr>
              <tr><td>Muscle Gain</td><td>{results.muscleGainRecomp} cal</td></tr>
            </tbody>
          </table>
        </div>
      )}

      {/* ABOUT SECTION */}
      <div className="tdee-info-section">
        <h2>üí° About This Calculator</h2>
        <p>
          This calculator estimates your <strong>Total Daily Energy Expenditure (TDEE)</strong> ‚Äî 
          the number of calories you burn daily based on your lean body mass and activity level.
        </p>
        <p>Use it to determine how much to eat for your goal:</p>
        <ul>
          <li>üîª Lose <strong>1‚Äì2 lbs per week</strong> with a calorie deficit</li>
          <li>‚öñÔ∏è Maintain your current weight</li>
          <li>üí™ Gain muscle with a <strong>lean bulk</strong> calorie surplus</li>
        </ul>
      </div>
    </div>
  );
}

export default DeficitTimeCalculator;
